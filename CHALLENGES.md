# üõ†Ô∏è –¢—Ä—É–¥–Ω–æ—Å—Ç–∏ –∏ –∏—Ö —Ä–µ—à–µ–Ω–∏—è

## 1. –ö–∞—Å—Ç–æ–º–Ω—ã–µ Primary Key

### –ü—Ä–æ–±–ª–µ–º–∞
–¢—Ä–µ–±–æ–≤–∞–Ω–∏–µ —Ç–µ—Å—Ç–æ–≤–æ–≥–æ –∑–∞–¥–∞–Ω–∏—è: "–≤ –∫–∞—á–µ—Å—Ç–≤–µ PK –¥–ª—è –æ—Å–Ω–æ–≤–Ω—ã—Ö —Å—É—â–Ω–æ—Å—Ç–µ–π –∑–∞–ø—Ä–µ—â–µ–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å UUID, –º–æ–¥—É–ª—å random, —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ Postgres –∏ —Ü–µ–ª–æ—á–∏—Å–ª–µ–Ω–Ω—ã–µ –∏–Ω–∫—Ä–µ–º–µ–Ω—Ç—ã"

### –†–µ—à–µ–Ω–∏–µ
–°–æ–∑–¥–∞–Ω–∞ —Ñ—É–Ω–∫—Ü–∏—è `generate_custom_id()` –≤ `django_backend/todo_app/models.py`:

```python
def generate_custom_id():
    """–ì–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç –∫–∞—Å—Ç–æ–º–Ω—ã–π ID –Ω–∞ –æ—Å–Ω–æ–≤–µ –≤—Ä–µ–º–µ–Ω–∏ –∏ —Ö–µ—à–∞."""
    timestamp = str(int(time.time() * 1000000))  # –º–∏–∫—Ä–æ—Å–µ–∫—É–Ω–¥—ã
    hash_obj = hashlib.md5(timestamp.encode())
    return hash_obj.hexdigest()[:12]  # 12 —Å–∏–º–≤–æ–ª–æ–≤
```

**–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞**:
- –£–Ω–∏–∫–∞–ª—å–Ω–æ—Å—Ç—å –∑–∞ —Å—á–µ—Ç –º–∏–∫—Ä–æ—Å–µ–∫—É–Ω–¥
- –î–µ—Ç–µ—Ä–º–∏–Ω–∏—Ä–æ–≤–∞–Ω–Ω–æ—Å—Ç—å (–æ–¥–∏–Ω timestamp = –æ–¥–∏–Ω —Ö–µ—à)
- –ö–æ–º–ø–∞–∫—Ç–Ω–æ—Å—Ç—å (12 —Å–∏–º–≤–æ–ª–æ–≤)
- –°–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è–º

## 2. –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è Aiogram-Dialog —Å Django API

### –ü—Ä–æ–±–ª–µ–º–∞
–ù–µ–æ–±—Ö–æ–¥–∏–º–æ —Å–≤—è–∑–∞—Ç—å –¥–∏–∞–ª–æ–≥–æ–≤—É—é —Å–∏—Å—Ç–µ–º—É Telegram –±–æ—Ç–∞ —Å REST API Django, –æ–±–µ—Å–ø–µ—á–∏–≤ –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ–µ –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–µ.

### –†–µ—à–µ–Ω–∏–µ
–°–æ–∑–¥–∞–Ω –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–π API –∫–ª–∏–µ–Ω—Ç `telegram_bot/api_client.py`:

```python
class APIClient:
    async def __aenter__(self):
        self.session = aiohttp.ClientSession()
        return self
    
    async def get_tasks(self, telegram_user_id: int):
        # –ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–µ HTTP –∑–∞–ø—Ä–æ—Å—ã –∫ Django API
```

**–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –≤ –¥–∏–∞–ª–æ–≥–∞—Ö**:
```python
async def get_tasks_data(dialog_manager: DialogManager, **kwargs):
    async with APIClient() as api:
        tasks = await api.get_tasks(user_id)
    return {'tasks': tasks}
```

## 3. –ß–∞—Å–æ–≤–æ–π –ø–æ—è—Å America/Adak

### –ü—Ä–æ–±–ª–µ–º–∞
–¢—Ä–µ–±–æ–≤–∞–Ω–∏–µ —Ä–∞–±–æ—Ç—ã –≤ —Å–ø–µ—Ü–∏—Ñ–∏—á–µ—Å–∫–æ–º —á–∞—Å–æ–≤–æ–º –ø–æ—è—Å–µ America/Adak (UTC-10/-9).

### –†–µ—à–µ–Ω–∏–µ
–í `django_backend/todo_project/settings.py`:

```python
TIME_ZONE = 'America/Adak'
USE_TZ = True

# Celery —Ç–∞–∫–∂–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç —ç—Ç–æ—Ç —á–∞—Å–æ–≤–æ–π –ø–æ—è—Å
CELERY_TIMEZONE = TIME_ZONE
```

**–ü—Ä–æ–≤–µ—Ä–∫–∞**:
- –í—Å–µ –≤—Ä–µ–º–µ–Ω–Ω—ã–µ –º–µ—Ç–∫–∏ —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è —Å —É—á–µ—Ç–æ–º —á–∞—Å–æ–≤–æ–≥–æ –ø–æ—è—Å–∞
- Celery –∑–∞–¥–∞—á–∏ –ø–ª–∞–Ω–∏—Ä—É—é—Ç—Å—è –≤ –ø—Ä–∞–≤–∏–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏
- API –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –≤—Ä–µ–º—è –≤ –Ω—É–∂–Ω–æ–π –∑–æ–Ω–µ

## 4. –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è —á–µ—Ä–µ–∑ Celery –≤ Telegram

### –ü—Ä–æ–±–ª–µ–º–∞
–ö–∞–∫ –æ—Ç–ø—Ä–∞–≤–ª—è—Ç—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ –∑–∞–¥–∞—á–∞—Ö –∏–∑ Celery worker –≤ Telegram –±–æ—Ç, –∫–æ—Ç–æ—Ä—ã–π —Ä–∞–±–æ—Ç–∞–µ—Ç –≤ –æ—Ç–¥–µ–ª—å–Ω–æ–º –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–µ.

### –†–µ—à–µ–Ω–∏–µ
–°–æ–∑–¥–∞–Ω–∞ —Å–∏—Å—Ç–µ–º–∞ –∑–∞–¥–∞—á –≤ `django_backend/todo_app/tasks.py`:

```python
@shared_task
def send_task_notification(task_id):
    # –ü–æ–ª—É—á–∞–µ–º –∑–∞–¥–∞—á—É –∏–∑ –ë–î
    task = Task.objects.get(id=task_id)
    
    # –û—Ç–ø—Ä–∞–≤–ª—è–µ–º —á–µ—Ä–µ–∑ HTTP API –±–æ—Ç–∞
    if task.telegram_user_id:
        send_telegram_notification.delay(
            task.telegram_user_id,
            f"‚è∞ –ù–∞–ø–æ–º–∏–Ω–∞–Ω–∏–µ –æ –∑–∞–¥–∞—á–µ!\nüìù {task.title}"
        )
```

**–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞**:
1. Django –ø–ª–∞–Ω–∏—Ä—É–µ—Ç Celery –∑–∞–¥–∞—á—É –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –∑–∞–¥–∞—á–∏ —Å –¥–µ–¥–ª–∞–π–Ω–æ–º
2. Celery worker –≤—ã–ø–æ–ª–Ω—è–µ—Ç –∑–∞–¥–∞—á—É –≤ –Ω—É–∂–Ω–æ–µ –≤—Ä–µ–º—è
3. Worker –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç HTTP –∑–∞–ø—Ä–æ—Å –∫ –±–æ—Ç—É –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ —Å–æ–æ–±—â–µ–Ω–∏—è

## 5. Docker –æ—Ä–∫–µ—Å—Ç—Ä–∞—Ü–∏—è —Å –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—è–º–∏

### –ü—Ä–æ–±–ª–µ–º–∞
–ü—Ä–∞–≤–∏–ª—å–Ω–∞—è –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—å –∑–∞–ø—É—Å–∫–∞ —Å–µ—Ä–≤–∏—Å–æ–≤: PostgreSQL ‚Üí Django ‚Üí Celery ‚Üí Bot

### –†–µ—à–µ–Ω–∏–µ
–í `docker-compose.yml` –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω—ã health checks –∏ depends_on:

```yaml
django:
  depends_on:
    postgres:
      condition: service_healthy
    redis:
      condition: service_healthy

celery:
  depends_on:
    django:
      condition: service_started
```

**Health checks**:
```yaml
postgres:
  healthcheck:
    test: ["CMD-SHELL", "pg_isready -U postgres"]
    interval: 10s
    timeout: 5s
    retries: 5
```

## 6. –ü–æ–∫–∞–∑ –¥–∞—Ç—ã —Å–æ–∑–¥–∞–Ω–∏—è –≤ –±–æ—Ç–µ

### –ü—Ä–æ–±–ª–µ–º–∞
–¢—Ä–µ–±–æ–≤–∞–Ω–∏–µ: "–í–∞–∂–Ω–æ, —á—Ç–æ–±—ã —É —Ç–∞—Å–∫–∏ –ø–æ–∫–∞–∑—ã–≤–∞–ª–∞—Å—å –¥–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è"

### –†–µ—à–µ–Ω–∏–µ
–í –¥–∏–∞–ª–æ–≥–∞—Ö –±–æ—Ç–∞ –¥–æ–±–∞–≤–ª–µ–Ω–æ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –¥–∞—Ç—ã:

```python
async def get_task_detail_data(dialog_manager: DialogManager, **kwargs):
    return {
        'task_created': task['created_at'][:10] if task else '',  # –¢–æ–ª—å–∫–æ –¥–∞—Ç–∞
    }
```

–í —à–∞–±–ª–æ–Ω–µ –¥–∏–∞–ª–æ–≥–∞:
```python
Format("üìù {task_title}\n"
       "üìÖ –°–æ–∑–¥–∞–Ω–æ: {task_created}")
```

## 7. –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —Å–æ–∑–¥–∞–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π

### –ü—Ä–æ–±–ª–µ–º–∞
–ö–∞–∫ —Å–≤—è–∑–∞—Ç—å Telegram –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π —Å Django User –º–æ–¥–µ–ª—å—é.

### –†–µ—à–µ–Ω–∏–µ
–í —Å–µ—Ä–∏–∞–ª–∏–∑–∞—Ç–æ—Ä–µ `TaskCreateSerializer`:

```python
def create(self, validated_data):
    telegram_user_id = validated_data.get('telegram_user_id')
    
    if telegram_user_id:
        user, created = User.objects.get_or_create(
            username=f'tg_{telegram_user_id}',
            defaults={
                'first_name': f'User_{telegram_user_id}',
                'is_active': True
            }
        )
        validated_data['user'] = user
```

## 8. –°–æ—Å—Ç–æ—è–Ω–∏—è –¥–∏–∞–ª–æ–≥–æ–≤ –≤ Redis

### –ü—Ä–æ–±–ª–µ–º–∞
Aiogram-dialog —Ç—Ä–µ–±—É–µ—Ç —Ö—Ä–∞–Ω–µ–Ω–∏—è —Å–æ—Å—Ç–æ—è–Ω–∏–π –º–µ–∂–¥—É —Å–æ–æ–±—â–µ–Ω–∏—è–º–∏.

### –†–µ—à–µ–Ω–∏–µ
–ù–∞—Å—Ç—Ä–æ–µ–Ω –æ—Ç–¥–µ–ª—å–Ω—ã–π Redis database –¥–ª—è –±–æ—Ç–∞:

```python
# –í telegram_bot/config.py
REDIS_URL = os.getenv('REDIS_URL', 'redis://localhost:6379/1')

# –í docker-compose.yml —Ä–∞–∑–Ω—ã–µ –±–∞–∑—ã Redis:
# Celery: redis://redis:6379/0
# Bot: redis://redis:6379/1
```

## –ò—Ç–æ–≥–∏

–í—Å–µ –æ—Å–Ω–æ–≤–Ω—ã–µ —Ç—Ä—É–¥–Ω–æ—Å—Ç–∏ –±—ã–ª–∏ —É—Å–ø–µ—à–Ω–æ —Ä–µ—à–µ–Ω—ã:
- ‚úÖ –ö–∞—Å—Ç–æ–º–Ω—ã–µ PK –±–µ–∑ UUID/random/–∞–≤—Ç–æ–∏–Ω–∫—Ä–µ–º–µ–Ω—Ç–æ–≤
- ‚úÖ –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è aiogram-dialog —Å Django API
- ‚úÖ –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è —á–µ—Ä–µ–∑ Celery
- ‚úÖ –ß–∞—Å–æ–≤–æ–π –ø–æ—è—Å America/Adak
- ‚úÖ Docker –æ—Ä–∫–µ—Å—Ç—Ä–∞—Ü–∏—è –≤—Å–µ—Ö —Å–µ—Ä–≤–∏—Å–æ–≤
- ‚úÖ –ü–æ–∫–∞–∑ –¥–∞—Ç—ã —Å–æ–∑–¥–∞–Ω–∏—è –∑–∞–¥–∞—á
- ‚úÖ –ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–∏–≤–Ω—ã–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å Django

–ü—Ä–æ–µ–∫—Ç –ø–æ–ª–Ω–æ—Å—Ç—å—é —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è–º —Ç–µ—Å—Ç–æ–≤–æ–≥–æ –∑–∞–¥–∞–Ω–∏—è.